# 一致指数（Index of Coincidence：IC）

## ICとは何か、なぜ重要か

**一致指数（IC）** は、テキストからランダムに2文字を取り出したとき、それらが同じ文字である確率を表す統計量です。  
1920年代に暗号学者ウィリアム・フリードマンによって古典暗号解読の道具として導入されました。

- **暗号解読の視点**  
  自然言語テキストは文字の出現が一様分布ではありません（例：英語では E が多く、Z は少ない）。  
  そのため、自然言語の IC 値はランダム文字列よりも高くなります。  
  暗号解析者はこの差を利用し、暗号文が単一換字式か多表式（例：ヴィジュネル暗号）かを判別したり、鍵長を推定するために使います。

- **言語学・統計の視点**  
  IC は文字分布の「偏り」の度合いを測る指標です。  
  各言語は固有の文字頻度分布を持つため、IC 値にも特徴が現れます。  
  たとえば、英語の IC は約 0.066〜0.068、ランダム文字列の IC は 0.0385 です。  
  これにより「このテキストは意味のある言語か？ランダムノイズか？」を判断する手がかりになります。

---

## 数式による定義と導出

テキストの長さを $N$、アルファベットの種類を $n$、文字 $i$ の出現回数を $m_i$ とすると、  
一致指数は次式で定義されます：

\[
IC = \sum_{i=1}^n \frac{m_i}{N} \cdot \frac{m_i - 1}{N - 1}
\]

これは同じ文字 $i$ を2回引く確率を表しています。整理すると、

\[
IC = \frac{1}{N(N-1)} \sum_{i=1}^n m_i (m_i - 1)
\]

- 分子：テキスト内で「同じ文字ペア」を選ぶ組み合わせの数  
- 分母：全ての文字ペアの組み合わせの数  

すなわち **「一致するペアの割合」** が IC です。

さらに、文字の出現確率 $p_i = m_i / N$ を使えば、大きな $N$ に対して近似的に

\[
IC \approx \sum_{i=1}^n p_i^2
\]

と表せます。  
つまり IC は「文字分布の自己相似度（二乗和）」を計算しているとも言えます。  

---

## 確率としての直感的理解

ICの意味を平易に言えば、以下のようになります。

> 「テキストから無作為に2文字を取り出したとき、それらが一致する確率」

たとえば $IC = 0.066$ なら「約 6.6% の確率で一致する」という意味になります。

- 一様分布 → どの文字も同じ頻度 → 一致する確率は小さい  
- 偏った分布 → よく出る文字（たとえば：E）が多い → その文字で一致する確率が高くなる  

---

## 別表現を使った視覚的理解

一致指数は、以下のような視覚的な方法でも理解できます：

テキストを適当な幅で折り返して配置したとき、上下の行で同じ位置に同じ文字が現れる頻度として捉えることができます。

```
The quick brown fox jumps over the lazy dog and
the rain in Spain stays mainly in the plain wh
```

この例では、上下の行で同じ位置を見ると：
- 1文字目: T と t（異なる）
- 2文字目: h と h（**一致**）
- 3文字目: e と e（**一致**）
- ...というように比較していきます。

### 言語の署名としての一致指数

どの言語の文章でも、このような「dの上にd」「wの上にw」といった一致が一定の頻度で発生します。この一致の頻度は：

- **測定可能**：統計的に計算できる
- **言語固有**：各言語で明確に異なる値を示す
- **特徴的**：各言語の「署名」のような役割を果たす

### 主要言語の一致指数

| 言語 | 一致指数 | パーセント表記 |
|------|----------|---------------|
| 英語 | 0.0667   | 約6.7%        |
| フランス語 | 0.0778 | 約7.8%     |
| ドイツ語 | 0.0762 | 約7.6%       |
| スペイン語 | 0.0775 | 約7.8%     |
| 完全ランダム | 0.0385 | 約3.8%（26文字の場合） |

この特性により、暗号文がどの言語で書かれたものか、あるいは暗号化の方法を推定する手がかりとして活用できます。

---

## ランダムテキストと自然言語の比較

- **ランダム文字列（英字26文字一様分布）**  
  \[
  IC_{\text{random}} = \frac{1}{26} \approx 0.0385
  \]

- **英語平文**  
  実測値はおよそ 0.065〜0.070（約6〜7%）  

つまり英語はランダム文字列よりも約2倍近い「一致のしやすさ」があることになります。  
これは「言語の文字頻度が不均衡である」ことの統計的表現です。  

---

## 計算例

例として、長さ $N=482$ の英文テキストで計算した場合：

- 各文字の $m_i(m_i-1)$ を合計すると ≈ 15,750  
- $N(N-1) = 482 \times 481 = 231,900$  
- よって

\[
IC = \frac{15750}{231900} \approx 0.0681
\]

となり、英語の典型的な値に近いことが確認できます。

---

## 暗号解読での応用

- **換字式と多表式の判別**  
  単一換字式暗号では IC が平文と同じ水準を保ちます。  
  一方、多表式暗号（ヴィジュネルなど）では分布が平坦化し、IC が 0.038〜0.05 付近まで下がります。

- **ヴィジュネル暗号の鍵長推定（フリードマンのテスト）**  
  鍵長 $L$ を仮定して暗号文を $L$ 本の列に分けると、  
  正しい $L$ なら各列は単一換字文になり、IC が言語固有の値に近づきます。  
  逆に間違った $L$ では IC がランダム水準に留まります。  
  この性質を使ってもっとも有力な鍵長を推定できます。

---

## 換字式暗号と転置式暗号におけるICの特徴

### 換字式暗号（Substitution Cipher）
- **ICの値は平文と変わらない**  
- 理由: 換字式暗号は文字を別の文字に置き換えるだけで、文字頻度分布自体は保持されるため。  
  - 例：英語の平文で E が 13% 出現すれば、暗号文では別の文字（例: Q）が 13% 出現する。  
  - 頻度分布が「ラベル置換」されただけなので、$\sum p_i^2$ の値は変わらず、IC も同じ。  
- **結論**: 英語なら暗号文の IC ≈ 0.066–0.068（平文と同等）。

### 転置式暗号（Transposition Cipher）
- **ICの値も平文と変わらない**  
- 理由: 転置式暗号は文字の並び順を入れ替えるだけであり、出現頻度や分布に影響を与えない。  
- **結論**: IC は平文と同等の値を示す。

### 両者の比較と限界
- **共通点**: 換字式も転置式も IC ≈ 平文の値。  
- **違い**:
  - 換字式では「どの文字が頻出か」が隠される（E→Qなど）。
  - 転置式では頻出文字がそのまま頻出として現れる。  
- **限界**: IC だけでは「換字式か転置式か」を判別できない。  
  → 判別には文字頻度分析や n-gram 解析など他の手法が必要。

### まとめ
- **単一換字式暗号**: IC ≈ 平文の IC（言語固有値）  
- **転置式暗号**: IC ≈ 平文の IC（言語固有値）  
- **多表式暗号（ヴィジュネルなど）**: IC がランダム水準（≈0.038）に近づく  

**結論**: IC は「単一換字／転置」と「多表式」を見分けるのに有効だが、  
換字と転置を区別するためには追加の解析が必要。

---

## ICでは区別できない場合の補助的手法

一致指数（IC）だけでは **単一換字式暗号** と **転置式暗号** を区別できません。  
そこで追加の解析が必要になります。代表的な手法は以下のとおりです。

### 1. 文字頻度分析
- **換字式**: 頻出文字は別の文字に置き換わるが、暗号文でも突出した頻出文字が存在する。  
- **転置式**: 頻度分布は平文と完全に一致する（頻出文字がそのまま頻出）。  

### 2. n-gram（バイグラム・トライグラム）解析
- **換字式**: 「th」「er」「ing」などの頻出ペアは別のペアに置換されても残る。  
- **転置式**: 並び順が崩れるため、自然な n-gram パターンは失われ、分布が平坦になる。  

### 3. 言語的パターン（母音・子音）
- **換字式**: 母音・子音のリズム（母音が連続しにくい等）は保持される。  
- **転置式**: 並び替えでリズムが崩れ、不自然な固まり方が見られる。  

### 4. 辞書攻撃・可読性チェック
- **換字式**: 部分復号に成功すれば、辞書的な単語が現れやすい。  
- **転置式**: 単語として読める部分がほとんど出ない。  

### 5. 位置的規則性の検出
- **転置式**: 列単位・ブロック単位の並び替えによって、一定周期のパターンが発生する。  
- **換字式**: 単純な置換なので位置に規則性は生じない。  

---

**まとめ:**  
- 換字式 → 頻度・n-gram・言語的パターンは保持されやすい。  
- 転置式 → 頻度は同じだが、n-gramや単語性が崩れ、位置的規則性が現れる。  

---

## 各種暗号方式と一致指数（IC）の特徴比較

### 単一換字式暗号（1文字 → 1文字）
- **例**: シーザー暗号、一般換字式暗号  
- **IC**: 平文と同じ値（言語固有の IC を保持）  
  - 理由: 出現頻度分布はラベルが置き換わるだけで変化しない。  
- **結論**: 英語なら IC ≈ 0.066–0.068。

### ダイグラフ置換暗号（2文字 → 1文字）
- **例**: ダイグラフ単一換字（ペアを1つの記号に対応させる方式）  
- **IC**: **計算対象の「文字単位」が異なる**ため、通常の IC と解釈が変わる。  
  - アルファベット26文字ではなく「可能なダイグラフ数（676種）」が母集団になる。  
  - 分布は平文言語の2文字連鎖（バイグラム頻度）を反映するため、**単文字ICよりもさらに高い偏り**が出る。  
  - 例：英語では "TH", "ER", "ON" などが頻出するため、対応する暗号文字が極端に多く出現 → IC が上昇。  
- **結論**: 計算枠組みによるが、**単文字ICより高い値**を示す傾向。

### プレイフェア暗号（2文字 → 2文字）
- **特徴**: 入力2文字を規則で別の2文字に換字する多対多方式。  
- **IC**: 単文字の頻度分布は大きく変化し、平文の IC から乖離する。  
  - プレイフェアは「同じ文字のペア回避」や「I/J同一視」など特殊な処理があるため、**単一換字式より IC が低下**する。  
  - 出力は26文字上で比較的平坦な分布に近づくため、**ランダム分布（≈0.038）に近いIC**になる。  
- **結論**: 単一換字より解析が難しく、ICは「言語固有値」と「ランダム値」の中間に落ちる。

### 多表式暗号（Polyalphabetic Cipher）
- **例**: ヴィジュネル暗号  
- **IC**: 鍵長によって値が変動する。  
  - 鍵長1（=単一換字）では平文の IC と同じ（≈0.066）。  
  - 鍵長が長いほど、分布はランダムに近づき **IC ≈ 0.038** に収束。  
  - 実際には、短い鍵長では部分的に平文分布が残り、中間的な値を示す。  
- **結論**: **ICの低下度合い**から鍵長推定が可能（フリードマンの方法）。

---

## まとめ表

| 暗号方式                 | 出力単位 | ICの傾向                         | 備考                                   |
|--------------------------|---------|---------------------------------|--------------------------------------|
| 単一換字式               | 1文字   | 平文と同じ（言語固有値）         | 頻度分布はそのまま保持                |
| ダイグラフ置換（2→1）    | 1文字   | 単文字ICより高くなる傾向          | 言語のバイグラム偏りが強く反映        |
| プレイフェア（2→2）      | 1文字   | 平文より低く、0.038〜0.05付近    | 単文字頻度を均等化する方向に働く      |
| 多表式（例: ヴィジュネル）| 1文字   | 鍵長に応じて平文値→ランダム値へ   | ICの観測値から鍵長を推定可能          |

---

**結論**:  
- 単一換字・転置 → ICは平文と同じ。  
- ダイグラフ置換 → バイグラム頻度の偏りで IC はさらに高くなる。  
- プレイフェア → 頻度が均されるため IC は低下し、ランダムに近づく。  
- 多表式 → 鍵長が伸びるにつれて IC がランダム水準に近づく。  

---

## 関連する統計量（一覧）

- **エントロピー（Shannon Entropy）**  
  文字分布の平均的不確実性を測る。高いほどランダム、低いほど偏りが強い。  
- **カイ二乗統計量（Chi-Squared）**  
  観測分布が期待分布からどれだけずれているかを測る。  
- **KLダイバージェンス（相対エントロピー）**  
  ある分布が基準分布からどれだけ離れているかを測る。  
- **Rényiエントロピー（2次）**  
  $H_2 = -\log \sum p_i^2$。IC の対数変換に相当。  
- **自己相関（Autocorrelation）**  
  テキストをシフトして比較したときの一致度。繰り返しパターン検出に用いる。  

---

## 参考資料

- 論文 "The Index of Coincidence and Its Applications in Cryptography"（「一致指数および暗号解析への応用」）
  - 1922年、フリードマン（Friedman）がこの論文でICについて発表している。

---

## まとめ

一致指数（IC）は「文字分布の偏り」を測るシンプルかつ強力な指標であり、  

- 暗号解読（とくにヴィジュネル暗号の鍵長推定）  
- 言語学的分析（言語同定や文字分布の特徴付け）  

の両面で利用されてきました。  

直感的にも「2文字が一致する確率」として理解でき、暗号教育や統計学習に最適な題材です。
